# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# Adding a new metric? We have docs for that!
# https://firefox-source-docs.mozilla.org/toolkit/components/glean/user/new_definitions_file.html

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0
$tags:
  - "Toolkit :: Crash Reporting"

crash:
  compressed_store_size:
    type: memory_distribution
    description: >
      Size (in bytes) of the compressed crash store JSON file.

      This metric was generated to correspond to the Legacy Telemetry
      exponential histogram CRASH_STORE_COMPRESSED_BYTES.
    memory_unit: byte
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1950710
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1950710
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    expires: never
    telemetry_mirror: CRASH_STORE_COMPRESSED_BYTES

  submit_attempt:
    type: labeled_counter
    description: >
      An attempt to submit a crash. Keyed on the CrashManager Crash.type.

      This metric was generated to correspond to the Legacy Telemetry count
      histogram PROCESS_CRASH_SUBMIT_ATTEMPT.
    labels:
      - main-crash
      - main-hang
      - content-crash
      - content-hang
      - plugin-crash
      - plugin-hang
      - gmplugin-crash
      - gmplugin-hang
      - gpu-crash
      - gpu-hang
      - vr-crash
      - vr-hang
      - rdd-crash
      - rdd-hang
      - socket-crash
      - socket-hang
      - utility-crash
      - utility-hang
      - sandboxbroker-crash
      - sandboxbroker-hang
      - forkserver-crash
      - forkserver-hang
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1950710
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1950710
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    expires: never
    telemetry_mirror: h#PROCESS_CRASH_SUBMIT_ATTEMPT

  submit_success:
    type: dual_labeled_counter
    description: >
      The submission status when main/plugin/content crashes are submitted. 1 is
      success, 0 is failure. Keyed on the CrashManager Crash.type.

      This metric was generated to correspond to the Legacy Telemetry boolean
      histogram PROCESS_CRASH_SUBMIT_SUCCESS.
    dual_labels:
      key:
        description: The crash type.
      category:
        labels:
          - "false"
          - "true"
        description: Boolean
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1960567
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1960567
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    expires: never
    telemetry_mirror: PROCESS_CRASH_SUBMIT_SUCCESS

crash_submission:
  success:
    type: counter
    description: >
      Number of successfull crash report submissions
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_sensitivity:
      - technical
    expires: never
  failure:
    type: counter
    description: >
      Number of failed crash report submissions
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_sensitivity:
      - technical
    expires: never
  pending:
    type: counter
    description: >
      Number of pending crash report submissions
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_sensitivity:
      - technical
    expires: never
  collector_errors:
    type: labeled_counter
    description: >
      Amount and error name reported when performing crash submission.
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1873956
    data_sensitivity:
      - technical
    expires: never
  channel_status:
    type: labeled_counter
    description: >
      Collecting XHR channel status on error code when statusCode == 0.
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1905633
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1905633
    data_sensitivity:
      - technical
    expires: never
  failure_event:
    type: event
    description: A crash report failed to be submitted.
    notification_emails:
      - crash-reporting-wg@mozilla.org
      - stability@mozilla.org
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1976485
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1976485
    data_sensitivity:
      - technical
    expires: never
    extra_keys:
      id:
        description: A unique identifier for the crash.
        type: string
      reason:
        description: The reason why the crash failed to be submitted.
        type: string
