# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# Adding a new metric? We have docs for that!
# https://firefox-source-docs.mozilla.org/toolkit/components/glean/user/new_definitions_file.html

---
$schema: moz://mozilla.org/schemas/glean/metrics/2-0-0
$tags:
  - "Firefox :: Messaging System"

# Keys added to messaging_system should also be added to microsurvey below,
# unless they carry sensitive/identifying information. The microsurvey ping
# basically mirrors the messaging_system ping, except that it includes
# event_input_value and excludes client_id and browser_session_id, to protect
# the user's privacy. When in doubt, ask in the #omc Slack channel.
messaging_system:
  event_context_parse_error: &event_context_parse_error
    type: counter
    lifetime: ping
    description: |
      How often we failed to parse event_context as JSON.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_reason: &event_reason
    type: string
    lifetime: ping
    description: |
      The event_context's `reason`. Likely something like
      "welcome-window-closed" or "app-shut-down",.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_page: &event_page
    type: string
    lifetime: ping
    description: |
      The event_context's `page`. Almost always "about:welcome".
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_source: &event_source
    type: string
    lifetime: ping
    description: |
      The event_context's `source`. Likely something like "primary_button".
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_context: &event_context
    type: text
    lifetime: ping
    description: |
      The stringified JSON of `event_context`.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - web_activity
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_screen_family: &event_screen_family
    type: text
    lifetime: ping
    description: |
      A string identifier of the message family derived from the message id
      (e.g. MR_WELCOME_DEFAULT).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1867627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - web_activity
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
      - nsauermann@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_screen_id: &event_screen_id
    type: text
    lifetime: ping
    description: |
      A string identifier of the message screen id
      (e.g. AW_MOBILE_DOWNLOAD).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1867627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - web_activity
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
      - nsauermann@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_screen_initials: &event_screen_initials
    type: text
    lifetime: ping
    description: |
      A string identifier of the message screen initials
      (e.g. 'EMAG' for EASY_SETUP, MOBILE_DOWNLOADS, AMO, GRATITUDE).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1867627
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - web_activity
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
      - nsauermann@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event_screen_index: &event_screen_index
    type: quantity
    unit: integer
    lifetime: ping
    description: |
      A number identifier of the screen index in a sequence of screens
      (e.g. 0 for first message).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - web_activity
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
      - nsauermann@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  message_id: &message_id
    type: text
    lifetime: ping
    description: |
      A string identifier of the message in Activity Stream Router.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - web_activity
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  event: &event
    type: string
    description: >
      The type of event. Any user defined string
      (e.g. “IMPRESSION”, “CLICK_BUTTON”, "INDEXEDDB_OPEN_FAILED", “SESSION_END”)
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  ping_type: &ping_type
    type: string
    description: >
      Type of event the ping is capturing.
      e.g. "cfr", "onboarding"
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  source: &source
    type: string
    description: >
      The source of the interaction described by the other metrics.
      e.g. "frecent_links", "newtab", "CFR"
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  locale: &locale
    type: string
    lifetime: ping
    description: >
      The locale as supplied to the messaging system by
      `Services.locale.appLocaleAsBCP47`.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  client_id:
    type: uuid
    lifetime: ping
    description: |
      The client_id according to Telemetry.
      Might not always have a value due to policy around specific types of
      ping being sent. Value may be the canary client id
      `c0ffeec0-ffee-c0ff-eec0-ffeec0ffeec0`
      in pings near when the data upload pref is disabled (if Telemetry gets
      to go first), or between when a client_id has been removed and when it
      has been regenerated.
      Present only in some circumstances (see
      [bug 1484035]https://bugzilla.mozilla.org/show_bug.cgi?id=1484035)).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1755549
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1484035
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1755549
    data_sensitivity:
      - technical
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  browser_session_id:
    type: uuid
    lifetime: ping
    # Disable yamllint for long lines.
    # yamllint disable
    description: >
      The Legacy Telemetry browser "session id".
      Identifies a specific period from application start to shutdown.
      See [the "main" ping docs](https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/data/main-ping.html)
      for details.
    # yamllint enable
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  impression_id: &impression_id
    type: uuid
    lifetime: ping
    description: >
      The unique impression identifier for a specific client.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  bucket_id: &bucket_id
    type: string
    lifetime: ping
    description: >
      A name shared between multiple messages that may individually be too
      targeted. e.g. a message that gets shown on specific websites or a message
      asking about personal information.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  addon_version: &addon_version
    type: string
    lifetime: ping
    description: >
      Used to hold the system addon's version,
      now is almost certainly an echo of the app's build id.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  unknown_key_count: &unknown_key_count
    type: counter
    description: |
      The sum of all unknown keys counted.
      Useful for testing.
      Can be removed after bug 1600008 is resolved.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - chutten@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  unknown_keys: &unknown_keys
    type: labeled_counter
    description: |
      Ping keys supplied to the messaging system for which
      we did not have a corresponding metric mapped to how often they attempted
      to be recorded.
      You may have forgotten to define an appropriate metric in
      `browser/components/newtab/metrics.yaml`.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  glean_ping_for_ping_failures: &glean_ping_for_ping_failures
    type: counter
    description: |
      How often something went awry within
      `AboutWelcome.submitGleanPingForPing`, preventing ping submission.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
      - chutten@mozilla.com
    expires: never
    send_in_pings:
      - metrics

  invalid_nested_data: &invalid_nested_data
    type: labeled_counter
    description: |
      We received a ping with non-scalar data on a field of this name.
      If this is existing pre-PingCentre-replacement data, you may need to
      augment the logic in
      `AboutWelcome.submitGleanPingForPing` like the other `handledKeys`.
      If this is for new, post-PingCentre-replacement data, you should
      probably prefer a flat structure.
      If you're unsure, please ask in
      [the #glean channel](https://chat.mozilla.org/#/room/#glean:mozilla.org).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
      - chutten@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  message_request_time:
    type: timing_distribution
    description: >
      Firefox: Time in ms spent selecting and matching messages to user profile.

      This metric was generated to correspond to the Legacy Telemetry
      exponential histogram MS_MESSAGE_REQUEST_TIME_MS.
    time_unit: millisecond
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1600335
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1600335
    notification_emails:
      - omc-core@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    telemetry_mirror: MS_MESSAGE_REQUEST_TIME_MS

messaging_system.attribution:
  source: &attribution_source
    type: string
    lifetime: ping
    description: |
      Attribution's source, possibly derived from the utm parameter of the same
      name.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  medium: &attribution_medium
    type: string
    lifetime: ping
    description: |
      Attribution's medium, possibly derived from the utm parameter of the same
      name.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  campaign: &attribution_campaign
    type: string
    lifetime: ping
    description: |
      Attribution's campaign, possibly derived from the utm parameter of the
      same name.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  content: &attribution_content
    type: string
    lifetime: ping
    description: |
      Attribution's content, possibly derived from the utm parameter of the
      same name.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  experiment: &attribution_experiment
    type: string
    lifetime: ping
    description: |
      Attribution's experiment key.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  variation: &attribution_variation
    type: string
    lifetime: ping
    description: |
      Attribution's variation key.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  ua: &attribution_ua
    type: string
    lifetime: ping
    description: |
      Attribution's ua key.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  dltoken: &attribution_dltoken
    type: string
    lifetime: ping
    description: |
      String representation of the dltoken identifying the particular
      installer used to install this Firefox.
      Likely a UUID, if present.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  msstoresignedin: &attribution_msstoresignedin
    type: string
    lifetime: ping
    description: |
      Either the string "true" or the string "false" to indicate whether the
      attributed install came from the Microsoft store and, if so, whether the
      user was signed in at the time.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1756209
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1756209
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  msclkid: &attribution_msclkid
    type: string
    lifetime: ping
    description: |
      A string containing the attribution for a Microsoft Store Ads Campaign ID.
      This differs from a Campaign ID originating from a Microsoft Store URL
      containing attribution_
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=2004494
    data_reviews:
      - https://phabricator.services.mozilla.com/D275328
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  dlsource: &attribution_dlsource
    type: string
    lifetime: ping
    description: |
      Mozilla-specific download "source" name. Could be something like
      "mozillaci" to identify that the installer came from
      `{archive|ftp}.mozilla.org`.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1819997
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1819997
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - interaction
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

  unknown_keys: &attribution_unknown_keys
    type: labeled_counter
    description: |
      Attribution keys supplied to the messaging system for which
      we did not have a corresponding metric, and the count of how
      often that happened.
      Either add this key to a list of known attribution keys in
      `AboutWelcomeTelemetry` to suppress or define an appropriate metric in
      `browser/components/newtab/metrics.yaml` to collect.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1825863
    data_sensitivity:
      - technical
    notification_emails:
      - dmosedale@mozilla.com
      - pmcmanis@mozilla.com
    expires: never
    send_in_pings:
      - messaging-system

# Most keys in microsurvey are alias nodes corresponding to those in
# messaging_system, to keep the two pings in sync. The main exceptions are
# event_input_value, which is unique to microsurvey, and client_id and
# browser_session_id, which are omitted from microsurvey for privacy reasons.
# Some other keys are excluded from microsurvey as they are not relevant there,
# e.g. message_request_time. These are used for high-level monitoring of the
# messaging system as a whole, rather than for analyzing individual messages.
microsurvey:
  event_input_value:
    type: text
    lifetime: ping
    description: |
      Text input by the user in a write-in textarea produced by the textarea
      tile type. Truncated to 8KB (though the textarea tile normally has a
      separate character limit enforced at display time).
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=2010984
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=2010984
    data_sensitivity:
      - web_activity
      - highly_sensitive
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - microsurvey

  event_context_parse_error:
    <<: *event_context_parse_error
    send_in_pings:
      - microsurvey

  event_reason:
    <<: *event_reason
    send_in_pings:
      - microsurvey

  event_page:
    <<: *event_page
    send_in_pings:
      - microsurvey

  event_source:
    <<: *event_source
    send_in_pings:
      - microsurvey

  event_context:
    <<: *event_context
    send_in_pings:
      - microsurvey

  event_screen_family:
    <<: *event_screen_family
    send_in_pings:
      - microsurvey

  event_screen_id:
    <<: *event_screen_id
    send_in_pings:
      - microsurvey

  event_screen_initials:
    <<: *event_screen_initials
    send_in_pings:
      - microsurvey

  event_screen_index:
    <<: *event_screen_index
    send_in_pings:
      - microsurvey

  message_id:
    <<: *message_id
    send_in_pings:
      - microsurvey

  event:
    <<: *event
    send_in_pings:
      - microsurvey

  ping_type:
    <<: *ping_type
    send_in_pings:
      - microsurvey

  source:
    <<: *source
    send_in_pings:
      - microsurvey

  locale:
    <<: *locale
    send_in_pings:
      - microsurvey

  impression_id:
    <<: *impression_id
    send_in_pings:
      - microsurvey

  bucket_id:
    <<: *bucket_id
    send_in_pings:
      - microsurvey

  addon_version:
    <<: *addon_version
    send_in_pings:
      - microsurvey

  unknown_key_count:
    <<: *unknown_key_count
    send_in_pings:
      - microsurvey

  unknown_keys:
    <<: *unknown_keys
    send_in_pings:
      - microsurvey

  glean_ping_for_ping_failures:
    <<: *glean_ping_for_ping_failures
    send_in_pings:
      - microsurvey

  invalid_nested_data:
    <<: *invalid_nested_data
    send_in_pings:
      - microsurvey

  # These metrics are copies of certain metadata fields that get removed because
  # the microsurvey ping has `include_info_sections: false` (see pings.yaml).
  os:
    type: string
    lifetime: ping
    description: |
      The name of the operating system.
      Possible values:
      Android, iOS, Linux, Darwin, Windows,
      FreeBSD, NetBSD, OpenBSD, Solaris, Unknown
    bugs:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/1497894
      - https://bugzilla.mozilla.org/1944090
    data_reviews:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - microsurvey

  os_version:
    type: string
    lifetime: ping
    description: |
      The user-visible version of the operating system (e.g. "1.2.3").
      If the version detection fails, this metric gets set to `Unknown`.
    bugs:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/1497894
      - https://bugzilla.mozilla.org/1944090
    data_reviews:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1512938#c3
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - microsurvey

  windows_build_number:
    type: quantity
    unit: build_number
    lifetime: ping
    description: |
      The optional Windows build number, reported by Windows
      (e.g. 22000) and not set for other platforms.
    bugs:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/1802094
      - https://bugzilla.mozilla.org/1944090
    data_reviews:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/1802094
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - microsurvey

  app_display_version:
    type: string
    lifetime: ping
    description: |
      The user visible version string (e.g. "1.0.3").
      If the value was not provided through configuration,
      this metric gets set to `Unknown`.
    bugs:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/1508305
      - https://bugzilla.mozilla.org/1944090
    data_reviews:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1508305#c9
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - microsurvey

  app_channel:
    type: string
    lifetime: ping
    description: |
      The channel the application is being distributed on.
    bugs:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/1520741
      - https://bugzilla.mozilla.org/1944090
    data_reviews:
      - https://bugzilla.mozilla.org/2010984
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1520741#c18
    data_sensitivity:
      - technical
    notification_emails:
      - pmcmanis@mozilla.com
      - dmosedale@mozilla.com
    expires: never
    send_in_pings:
      - microsurvey

microsurvey.attribution:
  source:
    <<: *attribution_source
    send_in_pings:
      - microsurvey

  medium:
    <<: *attribution_medium
    send_in_pings:
      - microsurvey

  campaign:
    <<: *attribution_campaign
    send_in_pings:
      - microsurvey

  content:
    <<: *attribution_content
    send_in_pings:
      - microsurvey

  experiment:
    <<: *attribution_experiment
    send_in_pings:
      - microsurvey

  variation:
    <<: *attribution_variation
    send_in_pings:
      - microsurvey

  ua:
    <<: *attribution_ua
    send_in_pings:
      - microsurvey

  dltoken:
    <<: *attribution_dltoken
    send_in_pings:
      - microsurvey

  msstoresignedin:
    <<: *attribution_msstoresignedin
    send_in_pings:
      - microsurvey

  msclkid:
    <<: *attribution_msclkid
    send_in_pings:
      - microsurvey

  dlsource:
    <<: *attribution_dlsource
    send_in_pings:
      - microsurvey

  unknown_keys:
    <<: *attribution_unknown_keys
    send_in_pings:
      - microsurvey
